<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç¯ç¯çš„è®°å¿†ç¢ç‰‡åŒ£</title>
  <style>
    :root{
      --bg:#f7f9fc;
      --card:#ffffff;
      --line:#e4e9f2;
      --text:#0f172a;
      --muted:#64748b;
      --blue:#2563eb;
      --blueSoft:#e8f0ff;
      --shadow: 0 10px 30px rgba(15, 23, 42, .08);
      --radius: 16px;
      --radius2: 12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "PingFang SC", "Microsoft YaHei", Arial;
      background: linear-gradient(180deg, #f7f9fc 0%, #f2f6ff 60%, #f7f9fc 100%);
      color:var(--text);
    }
    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .app{
      width:min(860px, 100%);
      height:min(720px, calc(100vh - 48px));
      background: rgba(255,255,255,.75);
      border:1px solid var(--line);
      border-radius: 22px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    .header{
      padding:16px 18px;
      background: var(--card);
      border-bottom:1px solid var(--line);
      display:flex;
      gap:10px;
      align-items:baseline;
      justify-content:space-between;
    }
    .title{
      display:flex; flex-direction:column; gap:4px;
    }
    .title b{font-size:16px}
    .title span{font-size:12px; color:var(--muted)}
    .badge{
      font-size:12px;
      color:var(--muted);
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
      background:#fbfcff;
    }

    .chips{
      padding:12px 18px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      border-bottom:1px solid var(--line);
      background: rgba(255,255,255,.55);
    }
    .chip{
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#ffffff;
      color: #334155;
      cursor:pointer;
    }
    .chip:hover{border-color:#cbd5e1}

    .messages{
      flex:1;
      min-height:0;                 /* âœ… å…³é”®ï¼šä¿è¯å¯æ»šåŠ¨ */
      overflow:auto;
      padding:16px 18px;
      display:flex;
      flex-direction:column;
      gap:10px;
      background: rgba(247, 249, 252, .55);
      -webkit-overflow-scrolling: touch;
    }
    .msg{
      max-width: 78%;
      padding:10px 12px;
      border-radius: var(--radius2);
      border:1px solid var(--line);
      background: #fff;
      line-height:1.55;
      font-size:14px;
      white-space:pre-wrap;
    }
    .ai{align-self:flex-start}
    .me{
      align-self:flex-end;
      background: var(--blueSoft);
      border-color: #cfe0ff;
    }
    .hint{
      font-size:12px;
      color:var(--muted);
      margin-top:2px;
    }

    .footer{
      padding:12px 12px;
      background: var(--card);
      border-top:1px solid var(--line);
      display:flex;
      gap:10px;
      align-items:center;
    }
    input{
      flex:1;
      font-size:14px;
      padding:12px 12px;
      border-radius: 12px;
      border:1px solid var(--line);
      outline:none;
      background:#fbfcff;
    }
    input:focus{border-color:#b9ccff}
    button{
      font-size:14px;
      padding:12px 14px;
      border-radius: 12px;
      border:1px solid #cfe0ff;
      background:#ffffff;
      cursor:pointer;
      color:#1d4ed8;
    }
    button:disabled{
      opacity:.6;
      cursor:not-allowed;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="app">
      <div class="header">
        <div class="title">
          <b>ç¯ç¯çš„è®°å¿†ç¢ç‰‡åŒ£</b>
          <span>é—®æˆ‘ä¸€ä¸ªå…·ä½“é—®é¢˜ï¼Œæˆ‘å°±ç¿»ä¸€æ®µç¢ç‰‡ç»™ä½  ğŸ™‚</span>
        </div>
        <div class="badge">basic</div>
      </div>

      <div class="chips">
        <div class="chip" data-q="ç¯ç¯æ˜¯è°ï¼Ÿ">å¥¹æ˜¯è°</div>
        <div class="chip" data-q="å¥¹åœ¨çº½çº¦æœ€å–œæ¬¢å»å“ªé‡Œï¼Ÿ">çº½çº¦å–œæ¬¢å»å“ª</div>
        <div class="chip" data-q="å¥¹åœ¨ç¾å›½å»è¿‡å“ªäº›åœ°æ–¹æ—…è¡Œï¼Ÿ">æ—…è¡Œå»è¿‡å“ª</div>
        <div class="chip" data-q="ç»™æˆ‘ä¸€ä¸ªçº½çº¦ç”Ÿæ´»ç¢ç‰‡ã€‚">æ¥ä¸ªç”Ÿæ´»ç¢ç‰‡</div>
        <div class="chip" data-q="å¥¹çš„å…´è¶£çˆ±å¥½æ˜¯ä»€ä¹ˆï¼Ÿ">å…´è¶£çˆ±å¥½</div>
      </div>

      <div class="messages" id="messages"></div>

      <div class="footer">
        <input id="input" placeholder="æ¯”å¦‚ï¼šå¥¹åœ¨ç¾å›½å»è¿‡å“ªäº›åœ°æ–¹æ—…è¡Œï¼Ÿ" />
        <button id="send">å‘é€</button>
      </div>
    </div>
  </div>

  <script>
    // âœ… æ”¹è¿™é‡Œï¼šå¡«ä½ çš„ n8n Chat URLï¼ˆå¿…é¡»ä»¥ /chat ç»“å°¾ï¼‰
    const WEBHOOK_URL = "https://sl11565-n8n-free.hf.space/webhook/c3147549-60be-453e-9fbd-418219cfea28/chat";

    const $messages = document.getElementById("messages");
    const $input = document.getElementById("input");
    const $send = document.getElementById("send");
    const $chips = document.querySelectorAll(".chip");

    // âœ… é˜²å¹¶å‘ï¼šé¿å…è¿ç‚¹/å›è½¦å¯¼è‡´ä¸²ç­”
    let isSending = false;

    // å¯é€‰ï¼šä¿æŒä¼šè¯ï¼ˆå¦‚æœä½ ä¸æƒ³è¦ sessionï¼Œå°±æŠŠä¸‹é¢ä¸¤è¡Œåˆ æ‰ï¼Œå¹¶ä¸”åé¢ä¸ä¼  sessionIdï¼‰
    const sessionId = localStorage.getItem("mm_session") || (crypto.randomUUID?.() || String(Date.now()));
    localStorage.setItem("mm_session", sessionId);

    function addMsg(text, who){
      const d = document.createElement("div");
      d.className = `msg ${who}`;
      d.textContent = text;
      $messages.appendChild(d);
      $messages.scrollTop = $messages.scrollHeight;
      return d;
    }

    // âœ… å¯åŠ¨è¯­ï¼ˆç®€çŸ­ï¼Œä¸åˆ·å±ï¼‰
    addMsg("å—¨ï½æˆ‘æ˜¯ç¯ç¯çš„è®°å¿†ç¢ç‰‡åŒ£ğŸ€ å¯ä»¥å¸®ä½ äº†è§£å¥¹çš„å„ç§ç”Ÿæ´»ç‰‡æ®µï¼Œä½ æƒ³å…ˆé—®æ—…è¡Œã€çº½çº¦æ—¥å¸¸ã€å­¦ä¹ é¡¹ç›®ï¼Œè¿˜æ˜¯å…´è¶£çˆ±å¥½ï¼Ÿ", "ai");

    async function ask(q){
      const msg = (q ?? $input.value).trim();
      if(!msg) return;
      if(isSending) return;

      isSending = true;
      $send.disabled = true;
      $input.disabled = true;

      addMsg(msg, "me");
      $input.value = "";

      const thinking = addMsg("ï¼ˆæˆ‘ç¿»ç¿»ç¢ç‰‡â€¦ï¼‰", "ai");

      try{
        // âœ… ç”¨è¡¨å•æäº¤ï¼Œé€šå¸¸æ›´å°‘è§¦å‘é¢„æ£€éº»çƒ¦
        const form = new URLSearchParams();
        form.set("chatInput", msg);
        form.set("sessionId", sessionId); // å¦‚æœä½ ä¸éœ€è¦ä¼šè¯ï¼Œå¯åˆ é™¤è¿™è¡Œ

        const res = await fetch(WEBHOOK_URL, { method:"POST", body: form });

        if(!res.ok){
          thinking.textContent = `æˆ‘è¿™è¾¹æ²¡è¿ä¸Šï¼ˆHTTP ${res.status}ï¼‰ğŸ˜µâ€ğŸ’« ä½ å†å‘ä¸€æ¬¡è¯•è¯•ï¼Ÿ`;
          return;
        }

        const data = await res.json().catch(()=> ({}));

        // å…¼å®¹ä¸åŒè¿”å›å­—æ®µï¼ˆn8n/æ¨¡å‹èŠ‚ç‚¹å¯èƒ½ä¸ä¸€æ ·ï¼‰
        const out = data.output || data.reply || data.text || data.message || "";

        thinking.textContent = out || "æˆ‘è¿™æ®µæš‚æ—¶æ²¡ç¿»åˆ°å¯¹åº”ç¢ç‰‡ğŸ™‚ ä½ èƒ½æŠŠé—®é¢˜é—®å¾—æ›´å…·ä½“ä¸€ç‚¹å—ï¼Ÿï¼ˆæ¯”å¦‚åœ°ç‚¹/æ—¶é—´/å…³é”®è¯ï¼‰";
      } catch (e){
        thinking.textContent = "æˆ‘è¿™è¾¹åˆšåˆšå¡äº†ä¸€ä¸‹ğŸ˜µâ€ğŸ’« ä½ å†è¯•ä¸€æ¬¡ï¼Ÿ";
      } finally {
        isSending = false;
        $send.disabled = false;
        $input.disabled = false;
        $input.focus();
      }
    }

    $send.addEventListener("click", ()=> ask());
    $input.addEventListener("keydown", (e)=>{ if(e.key === "Enter") ask(); });
    $chips.forEach(c => c.addEventListener("click", ()=> ask(c.dataset.q)));
  </script>
</body>
</html>
