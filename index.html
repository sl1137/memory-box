<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç¯ç¯çš„è®°å¿†ç¢ç‰‡åŒ£</title>
  <style>
    :root{
      --bg:#f7f9fc;
      --card:#ffffff;
      --line:#e4e9f2;
      --text:#0f172a;
      --muted:#64748b;
      --blue:#2563eb;
      --blueSoft:#e8f0ff;
      --shadow: 0 10px 30px rgba(15, 23, 42, .08);
      --radius: 18px;
      --radius2: 14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "PingFang SC", "Microsoft YaHei", Arial;
      background: linear-gradient(180deg, #f7f9fc 0%, #eef4ff 55%, #f7f9fc 100%);
      color:var(--text);
    }
    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .app{
      width:min(860px, 100%);
      height:min(760px, calc(100vh - 48px));
      border-radius: 22px;
      background: rgba(255,255,255,.78);
      border:1px solid var(--line);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .header{
      padding:16px 18px;
      background: var(--card);
      border-bottom:1px solid var(--line);
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:center;
    }
    .title{
      display:flex; flex-direction:column; gap:4px;
    }
    .title b{font-size:16px}
    .title span{font-size:12px; color:var(--muted)}
    .badge{
      font-size:12px;
      color:var(--muted);
      border:1px solid var(--line);
      border-radius:999px;
      padding:6px 10px;
      background:#fbfcff;
      white-space:nowrap;
    }

    .messages{
      flex:1;
      min-height:0;          /* âœ… å…³é”®ï¼šä¿è¯å¯æ»šåŠ¨ */
      overflow:auto;
      padding:16px 18px;
      display:flex;
      flex-direction:column;
      gap:10px;
      background: rgba(247, 249, 252, .65);
      -webkit-overflow-scrolling: touch;
    }
    .msg{
      max-width: 80%;
      padding:10px 12px;
      border-radius: var(--radius2);
      border:1px solid var(--line);
      background: #fff;
      line-height:1.55;
      font-size:14px;
      white-space:pre-wrap;
    }
    .ai{align-self:flex-start}
    .me{
      align-self:flex-end;
      background: var(--blueSoft);
      border-color: #cfe0ff;
    }

    .footer{
      padding:12px 12px;
      background: var(--card);
      border-top:1px solid var(--line);
      display:flex;
      gap:10px;
      align-items:center;
    }
    input{
      flex:1;
      font-size:14px;
      padding:12px 12px;
      border-radius: 12px;
      border:1px solid var(--line);
      outline:none;
      background:#fbfcff;
    }
    input:focus{border-color:#b9ccff}
    button{
      font-size:14px;
      padding:12px 14px;
      border-radius: 12px;
      border:1px solid #cfe0ff;
      background:#ffffff;
      cursor:pointer;
      color:#1d4ed8;
    }
    button:disabled{opacity:.6; cursor:not-allowed;}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="app">
      <div class="header">
        <div class="title">
          <b>ç¯ç¯çš„è®°å¿†ç¢ç‰‡åŒ£</b>
          <span>ç›´æ¥é—®ä¸€ä¸ªå…·ä½“é—®é¢˜å°±å¥½ğŸ™‚</span>
        </div>
        <div class="badge">chatInput</div>
      </div>

      <div class="messages" id="messages"></div>

      <div class="footer">
        <input id="input" placeholder="æ¯”å¦‚ï¼šå¥¹åœ¨ç¾å›½å»è¿‡å“ªäº›åœ°æ–¹æ—…è¡Œï¼Ÿ" />
        <button id="send">å‘é€</button>
      </div>
    </div>
  </div>

  <script>
    // âœ… æ”¹è¿™é‡Œï¼šå¡«ä½ çš„ n8n Chat URLï¼ˆä»¥ /chat ç»“å°¾ï¼‰
    const WEBHOOK_URL = "https://sl11565-n8n-free.hf.space/webhook/c3147549-60be-453e-9fbd-418219cfea28/chat"
    const $messages = document.getElementById("messages");
    const $input = document.getElementById("input");
    const $send = document.getElementById("send");

    // âœ… é˜²å¹¶å‘ï¼šé¿å…è¿ç‚¹/å›è½¦å¯¼è‡´ä¸²ç­”
    let isSending = false;

    // å¯é€‰ï¼šä¿æŒä¼šè¯ï¼ˆä½ ä¸æƒ³è¦ session ä¹Ÿè¡Œï¼Œåˆ æ‰ sessionId + ä¸‹é¢ form.set é‚£è¡Œï¼‰
    const sessionId = localStorage.getItem("mm_session") || (crypto.randomUUID?.() || String(Date.now()));
    localStorage.setItem("mm_session", sessionId);

    function addMsg(text, who){
      const d = document.createElement("div");
      d.className = `msg ${who}`;
      d.textContent = text;
      $messages.appendChild(d);
      $messages.scrollTop = $messages.scrollHeight;
      return d;
    }

    // âœ… å¯åŠ¨è¯­ï¼šçŸ­ä¸€ç‚¹ï¼Œä¸ä¸»åŠ¨è¾“å‡ºå¤§æ®µ
    addMsg("å—¨ï½æˆ‘åœ¨è¿™ğŸ€ ä½ æƒ³å…ˆé—®å“ªä¸€æ®µç¢ç‰‡ï¼Ÿ", "ai");

    async function ask(){
      const msg = $input.value.trim();
      if(!msg || isSending) return;

      isSending = true;
      $send.disabled = true;
      $input.disabled = true;

      addMsg(msg, "me");
      $input.value = "";

      const thinking = addMsg("ï¼ˆæˆ‘ç¿»ç¿»ç¢ç‰‡â€¦ï¼‰", "ai");

      try{
        const form = new URLSearchParams();
        form.set("chatInput", msg);
        form.set("sessionId", sessionId); // ä¸éœ€è¦ä¼šè¯å°±åˆ æ‰è¿™è¡Œ

        const res = await fetch(WEBHOOK_URL, { method:"POST", body: form });

        if(!res.ok){
          thinking.textContent = `æˆ‘è¿™è¾¹æ²¡è¿ä¸Šï¼ˆHTTP ${res.status}ï¼‰ğŸ˜µâ€ğŸ’« ä½ å†è¯•ä¸€æ¬¡ï¼Ÿ`;
          return;
        }

        const data = await res.json().catch(()=> ({}));
        const out = data.output || data.reply || data.text || data.message || "";

        thinking.textContent = out || "æˆ‘è¿™æ®µæš‚æ—¶æ²¡ç¿»åˆ°å¯¹åº”ç¢ç‰‡ğŸ™‚ ä½ èƒ½æŠŠé—®é¢˜é—®å¾—æ›´å…·ä½“ä¸€ç‚¹å—ï¼Ÿ";
      }catch(e){
        thinking.textContent = "æˆ‘è¿™è¾¹åˆšåˆšå¡äº†ä¸€ä¸‹ğŸ˜µâ€ğŸ’« ä½ å†è¯•ä¸€æ¬¡ï¼Ÿ";
      }finally{
        isSending = false;
        $send.disabled = false;
        $input.disabled = false;
        $input.focus();
      }
    }

    $send.addEventListener("click", ask);
    $input.addEventListener("keydown", (e)=>{ if(e.key === "Enter") ask(); });
  </script>
</body>
</html>
